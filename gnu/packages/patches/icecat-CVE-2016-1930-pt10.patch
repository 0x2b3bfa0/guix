Copied from: https://hg.mozilla.org/releases/mozilla-esr38/rev/debff255c08e
Security advisory: https://www.mozilla.org/en-US/security/advisories/mfsa2016-01/
Mozilla Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1234571

# HG changeset patch
# User Randell Jesup <rjesup@jesup.org>
# Date 1451928471 18000
# Node ID debff255c08e898be370e307e1e014f5601c20c6
# Parent  f31d643afd4159b5422ae5aebcbbea0a088e018e
Bug 1234571 - unregister encoded-frame callback when releasing codec databases. r=pkerr, a=al

diff --git a/media/webrtc/trunk/webrtc/modules/video_coding/main/source/generic_encoder.cc b/media/webrtc/trunk/webrtc/modules/video_coding/main/source/generic_encoder.cc
--- a/media/webrtc/trunk/webrtc/modules/video_coding/main/source/generic_encoder.cc
+++ b/media/webrtc/trunk/webrtc/modules/video_coding/main/source/generic_encoder.cc
@@ -71,16 +71,17 @@ VCMGenericEncoder::VCMGenericEncoder(Vid
 VCMGenericEncoder::~VCMGenericEncoder()
 {
 }
 
 int32_t VCMGenericEncoder::Release()
 {
     _bitRate = 0;
     _frameRate = 0;
+    _encoder.RegisterEncodeCompleteCallback(NULL);
     _VCMencodedFrameCallback = NULL;
     return _encoder.Release();
 }
 
 int32_t
 VCMGenericEncoder::InitEncode(const VideoCodec* settings,
                               int32_t numberOfCores,
                               uint32_t maxPayloadSize)

